
<!DOCTYPE html>
<html>
<head>
  <title>Born, Growing Up.</title>
  <meta name="author" content="William Ghelfi" />
  <meta charset="utf-8" />
  
  <meta name="description" content=" How to set up environment specific configurations with Ionic and Webpack June 22nd, 2017 At the time of writing, Ionic hasn’t any official way to get environment specific configuration variables. There’s an open discussion on GitHub, but everyone is currently on their own about this. So of cours..."/>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/screen.css" rel="stylesheet" />
  <link href="/css/bootstrap-custom-utils.css" rel="stylesheet" />
  <link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" />
  <link href="/css/prism.css" rel="stylesheet" />

  
  <link rel="canonical" href="https://www.williamghelfi.com/" />
  <link href="/favicon.ico" rel="icon" />

  <link href="/atom.xml" rel="alternate" title="Born, Growing Up." type="application/atom+xml" />

</head>

<body >

<div class="container">

  <div class="row">

  <header role="banner" class="col-xs-12 col-md-10 col-md-offset-1 text-center">
    <h1><a href="/">Born, Growing Up.</a></h1>
    
    <h2>William Ghelfi</h2>
    
  </header>
  <nav role="navigation" class="col-xs-12 col-md-10 col-md-offset-1 navbar navbar-default">
    <ul class="nav navbar-nav">
      <!--
      <li><a href="/">Blog</a></li>
      -->
      <li><a href="/bootstrap-in-practice"><span class="icon-book"></span>&#32;Bootstrap In Practice</a></li>
      <li><a href="/blog/archives"><span class="icon-archive"></span>&#32;Archives</a></li>
      <li><a href="/about?rel=me"><span class="icon-user"></span>&#32;About</a></li>
    </ul>
    <ul class="nav navbar-nav pull-right">
      <li><a href="https://twitter.com/trumbitta"><span class="icon-twitter"></span></a></li>
      <li><a href="https://github.com/trumbitta"><span class="icon-github"></span></a></li>
      <li><a href="https://it.linkedin.com/in/williamghelfi"><span class="icon-linkedin"></span></a></li>
      <li><a rel="author" href="https://plus.google.com/114169273981533817065/about?rel=author"><span class="icon-google-plus"></span></a></li>
      <li><a class="navbar-link" href="/atom.xml" rel="subscribe-rss" title="Subscribe via RSS"><span class="icon-rss"></span></a></li>
    </ul>
  </nav>

  <div class="col-xs-12 col-md-10 col-md-offset-1">
  
  
  
    <article>
      
  <header>
    
      <h1><a href="/blog/2017/06/22/ionic-environments-webpack/">How to set up environment specific configurations with Ionic and Webpack</a></h1>
    
    
      <p class="meta">
        






<time datetime="2017-06-22T23:30:00+02:00" class="published">



June
  
22nd,
  
2017
</time>
<!--
        
-->
      </p>
    
  </header>

<p>At the time of writing, Ionic hasn’t any official way to get environment specific configuration variables.</p>

<p>There’s an <a href="https://github.com/ionic-team/ionic-app-scripts/issues/762">open discussion on GitHub</a>, but everyone is currently on their own about this.</p>

<p>So of course I came up with my own solution.</p>

<p>I’m going to describe it like it was the best solution in the world, like of course everyone should be doing this like I do.</p>

<p>In fact, there’s plenty more ways to solve this problem. This is just how I chose to solve it.</p>

<h2 id="1-how-many-environments">1. How many environments?</h2>

<p>Two: <code class="highlighter-rouge">dev</code>(elopment) and <code class="highlighter-rouge">prod</code>(uction).<br />
I’d really like to also have <code class="highlighter-rouge">stag</code>(ing) and <code class="highlighter-rouge">test</code>(ing), but first I’d have to find a better way to triage the current environment than the <code class="highlighter-rouge">IONIC_ENV</code> variable.</p>

<h2 id="2-json-files-to-store-the-variables">2. JSON files to store the variables</h2>

<p>JSON files are easy to read, and fairly easy to edit. They also are very easy to import into a node script.</p>

<p>I have two of them:</p>

<ul>
  <li><code class="highlighter-rouge">/config/config-dev.json</code></li>
  <li><code class="highlighter-rouge">/config/config-prod.json</code></li>
</ul>

<h3 id="sample-configconfig-devjson-file">Sample <code class="highlighter-rouge">/config/config-dev.json</code> file:</h3>

<pre class="margin-medium-bottom"><code class="language-json">
{
    foo: "bar",
    baz: "fooBar"
}
</code></pre>

<h2 id="3-custom-webpack-configuration-for-ionic">3. Custom Webpack configuration for Ionic</h2>

<p>This is an important one: Ionic uses Webpack, and we can specify our own Webpack configuration file. But if we do, the next time we update <code class="highlighter-rouge">@ionic/app-scripts</code> Ionic might stop working because we are missing some new configuration detail.</p>

<p>Instead we keep the official configuration, and expand it.</p>

<ul>
  <li>Add the following block to your <code class="highlighter-rouge">/package.json</code>:</li>
</ul>

<pre class="margin-medium-bottom"><code class="language-json">
    "config": {
        "ionic_webpack": "./config/webpack.config.js"
    },
</code></pre>

<ul>
  <li>Create <code class="highlighter-rouge">/config/webpack.config.js</code> and paste this code in it:</li>
</ul>

<pre class="margin-medium-bottom"><code class="language-javascript">
const webpackConfig = require('../node_modules/@ionic/app-scripts/config/webpack.config');
const webpack = require('webpack');

const ENV = process.env.IONIC_ENV;
const envConfigFile = require(`./config-${ENV}.json`);
const fooConfig = envConfigFile.foo;
const bazConfig = envConfigFile.baz;

webpackConfig.plugins.push(
    new webpack.DefinePlugin({
        webpackGlobalVars: {
            foo: JSON.stringify(fooConfig),
            baz: JSON.stringify(bazConfig)
        }
    })
);
</code></pre>

<p>As you can see, we are getting the official Webpack configuration and pushing a new plugin into it. No overrides, just an addition.</p>

<h2 id="4-a-configuration-service">4. A configuration service</h2>

<p>Create <code class="highlighter-rouge">/src/providers/configuration/configuration.service.ts</code>.<br />
You may have noticed I don’t dig the Ionic CLI proposed convention of naming a service <em>“provider”</em>. I also like to always know what kind of file I’m about to open, hence the <code class="highlighter-rouge">.service</code> part of the name.</p>

<p>This is where we use the newly defined <code class="highlighter-rouge">webpackGlobalVars</code> object to inject the environment-driven values into our Ionic / Angular code.</p>

<pre class="margin-medium-bottom"><code class="language-typescript">
import { Injectable } from '@angular/core';

declare const webpackGlobalVars: any;

@Injectable()
export class ConfigurationService {
    public static apiServer = webpackGlobalVars.foo;

    public static fooBar = {
        bazBaz: 'foo',
        fooBar: webpackGlobalVars.baz
    }

    // Add more configuration variables as needed
}
</code></pre>

<p>I chose to make them <code class="highlighter-rouge">static</code> out of sheer lazyness: this way, I don’t have to inject the service: I just <code class="highlighter-rouge">import</code> it and use it: <code class="highlighter-rouge">const myConst = ConfigurationService.fooBar</code>.</p>

<p>Now that I think about it, the <code class="highlighter-rouge">@Injectable</code> decoration might be unnecessary. I’ll try to remove it one day or another.</p>

<h2 id="conclusion">Conclusion</h2>

<p>So this is how I tackle the problem of having environment specific variables in Ionic.</p>

<p>Now I will have the values from <code class="highlighter-rouge">/config/config-dev.json</code> when I’m developing the app.<br />
When I use the <code class="highlighter-rouge">--prod</code> flag, I will have the values from <code class="highlighter-rouge">/config/config-prod.json</code> instead.</p>

<p>I think it’s fairly concise, effective, and as future proof as it gets.<br />
If you give it a try, <a href="https://twitter.com/trumbitta">let me know</a>!</p>

<!--

  

-->

    </article>
  
    <ul class="pager">
      
      <li class="previous"><a href="/blog/page/2">&larr; Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
    </ul>
</div>

  <footer role="contentinfo" class="col-xs-12 col-md-10 col-md-offset-1">
    <p class="text-muted text-center">
      Copyright &copy; 2018 &mdash; <a href="https://plus.google.com/u/0/114169273981533817065?rel=author">William Ghelfi</a> &mdash;
      <span class="credit">Powered by <a href="http://jekyllrb.com/">Jekyll</a></span>
    </p>
    <p class="text-muted text-center">
      The postings on this site are my own and don't necessarily represent my employer's positions, strategies or opinions.
    </p>
  </footer>
  </div>
</div>

  <script src="/js/prism.js"></script>
</body>
</html>
